export const $ = (sel, ctx=document) => ctx.querySelector(sel); export const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel)); export function delegate(parent, selector, type, handler){ parent.addEventListener(type, (e)=>{ const target = e.target.closest(selector); if(target && parent.contains(target)) handler(e, target); }); } import { $, $$ } from './dom.js'; import { saveSubmission, listSubmissions } from './storage.js'; const patterns = { cpf: /^\d{3}\.\d{3}\.\d{3}-\d{2}$/, telefone: /^\(\d{2}\) \d{5}-\d{4}$/, cep: /^\d{5}-\d{3}$/, email: /^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/ }; function maskCPF(v){ return v.replace(/\D/g,'').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d)/,'$1.$2').replace(/(\d{3})(\d{1,2})$/,'$1-$2'); } function maskPhone(v){ return v.replace(/\D/g,'').replace(/^(\d{2})(\d)/g,'($1) $2').replace(/(\d{5})(\d{4})$/,'$1-$2'); } function maskCEP(v){ return v.replace(/\D/g,'').replace(/(\d{5})(\d)/,'$1-$2'); } export function initForm(){ const form = $('#formCadastro'); if(!form) return; const cpf = $('#cpf'), tel = $('#telefone'), cep = $('#cep'); cpf?.addEventListener('input', ()=> cpf.value = maskCPF(cpf.value)); tel?.addEventListener('input', ()=> tel.value = maskPhone(tel.value)); cep?.addEventListener('input', ()=> cep.value = maskCEP(cep.value)); form.addEventListener('submit', (e)=>{ e.preventDefault(); const data = Object.fromEntries(new FormData(form).entries()); const erros = []; if(!patterns.email.test(data.email)) erros.push('E-mail inválido'); if(!patterns.cpf.test(data.cpf)) erros.push('CPF no formato 000.000.000-00'); if(!patterns.telefone.test(data.telefone)) erros.push('Telefone no formato (00) 00000-0000'); if(!patterns.cep.test(data.cep)) erros.push('CEP no formato 00000-000'); if(!data.nome?.trim()) erros.push('Nome é obrigatório'); if(!data.estado) erros.push('Selecione um estado'); if(!data.tipo) erros.push('Selecione o tipo de participação'); const feedback = $('#feedback'); if(erros.length){ feedback.textContent = 'Corrija: ' + erros.join(' · '); feedback.className = 'alert erro'; return; } saveSubmission(data); feedback.textContent = 'Cadastro enviado com sucesso!'; feedback.className = 'alert sucesso'; form.reset(); }); const historico = listSubmissions(); } const KEY = 'conectasocial_cadastros'; export function saveSubmission(data){ const atual = JSON.parse(localStorage.getItem(KEY) || '[]'); atual.push({ ...data, createdAt: new Date().toISOString() }); localStorage.setItem(KEY, JSON.stringify(atual)); } export function listSubmissions(){ return JSON.parse(localStorage.getItem(KEY) || '[]'); } import { $, $$, delegate } from './dom.js'; export function initAccessibility(){ const btn = $('#toggle-contrast'); if(btn){ const stored = localStorage.getItem('theme'); if(stored === 'dark') document.body.classList.add('dark-mode'); btn.addEventListener('click', ()=>{ document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light'); btn.setAttribute('aria-pressed', document.body.classList.contains('dark-mode')); }); } delegate(document, '.dropdown-toggle', 'keydown', (e, el)=>{ if(['Enter',' '].includes(e.key)){ e.preventDefault(); const expanded = el.getAttribute('aria-expanded') === 'true'; el.setAttribute('aria-expanded', (!expanded).toString()); el.parentElement.classList.toggle('open'); } }); const hamburger = $('#btn-hamburger'); const menu = $('#menu-principal'); if(hamburger && menu){ hamburger.addEventListener('click', ()=>{ const open = menu.classList.toggle('open'); hamburger.setAttribute('aria-expanded', open.toString()); }); } document.body.addEventListener('keydown', (e)=>{ if(e.key === 'Tab') document.body.classList.add('using-keyboard'); }); } import { $, $$ } from './dom.js'; import { initForm } from './forms.js'; import { initAccessibility } from './accessibility.js'; initAccessibility(); initForm(); async function loadPage(url){ try{ const res = await fetch(url); const html = await res.text(); const doc = new DOMParser().parseFromString(html, 'text/html'); const newMain = doc.querySelector('main'); const currentMain = document.querySelector('main'); if(newMain && currentMain){ currentMain.replaceWith(newMain); initForm(); const main = document.querySelector('main'); main?.setAttribute('tabindex', '-1'); main?.focus(); } history.pushState({}, '', url); }catch(err){ console.error('Falha ao carregar página:', err); } } document.addEventListener('click', (e)=>{ const a = e.target.closest('a[data-link]'); if(a && a.getAttribute('href')){ const url = a.getAttribute('href'); if(url.startsWith('http')) return; e.preventDefault(); loadPage(url); } }); window.addEventListener('popstate', ()=> loadPage(location.pathname));